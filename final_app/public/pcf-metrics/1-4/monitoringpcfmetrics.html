<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Monitoring PCF Metrics |
    Pivotal Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
<script type="text/javascript">
  if (window.location.host === 'docs.pivotal.io') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39702075-1']);
    _gaq.push(['_setDomainName', 'pivotal.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0055/2990.js?"+Math.floor(new Date().getTime()/3600000);
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>

<!-- Munchkin Marketo Script -->
<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="pcf-metrics pcf-metrics_1-4 pcf-metrics_1-4_monitoringpcfmetrics has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "pivotal.io";
    </script>

      <header class="global-header header header-layout js-bar-links">
    <a class="pivotal-logo" href="/">
    </a>
    <a href="/" class="global-header-title">
      <span class="title-deemph">Pivotal</span> Documentation
    </a>
    <div class="btn-menu" data-behavior="MenuMobile"></div>
    <div class="header-links">
      <div class="header-item">
        <a href="https://network.pivotal.io/">Downloads</a>
      </div>
      <div class="header-item">
        <a href="http://support.pivotal.io" target="_blank">Support</a>
      </div>

      <div class="header-item embedded-searchbar">
          <form method="get" action="/search">
            <input name="q" placeholder="Search PCF Metrics 1.4" class="search-box" />
              <input type="hidden" name="product_name" value="PCF Metrics" />
              <input type="hidden" name="product_version" value="1.4"/>
          </form>
      </div>
      
    </div>
  </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>
      <li>
        <a id='home-nav-link' href="/pcf-metrics/1-4/index.html">Pivotal Cloud Foundry Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/installing.html">Installing PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/sizing.html">Sizing PCF Metrics for Your System</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/using.html">Monitoring and Troubleshooting Apps with PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/monitoringpcfmetrics.html">Monitoring PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/troubleshooting.html">Troubleshooting PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/architecture.html">PCF Metrics Product Architecture</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/rn-ki.html">Release Notes and Known Issues</a>
      </li>

    </ul>
  </div>
</div><!--end of sub-nav-->
      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
          <div class="local-header title-container">
    <div class="local-header version-info">
      LATEST VERSION: 1.4 - <a href="">CHANGELOG</a>
    </div>
    <div class="local-header local-title clearfix">
      <img src="/images/cloud_rings.png">
      <span class="local-header-title">PCF Metrics
      </span>
      <span class="local-header local-version header-dropdown">
        <a class="local-header header-dropdown-link">v1.4</a>
        <span class="local-header header-dropdown-content">
          <ul>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-3/monitoringpcfmetrics.html">v1.3</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-2/monitoringpcfmetrics.html">v1.2</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-1/monitoringpcfmetrics.html">v1.1</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-0/monitoringpcfmetrics.html">v1.0</a>
                </li>
          </ul>
        </span>
      </span>

      <!-- search was here -->
    </div>
    <div class="local-header local-header-links">
    </div>
  </div>

          <h1 class="title-container" >
    Monitoring PCF Metrics
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul><li><a href="#kpi">Key Performance Indicators</a></li></ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <p>This topic explains how to monitor the health of the Pivotal Cloud Foundry (PCF) Metrics service using the logs, metrics, and Key Performance Indicators (KPIs) emitted by Cloud Foundry and the Metrics app itself.</p>

<h2><a id="kpi"></a>Key Performance Indicators</h2>

<p>KPIs for PCF Metrics are the metrics that operators find most useful for monitoring their PCF Metrics service. KPIs are high-signal-value metrics that can indicate emerging issues.</p>

<p>Pivotal provides the following KPIs as general alerting and response guidance for typical PCF Metrics installations.
Pivotal recommends that operators continue to fine-tune the alert measures to their installation by observing historical trends.
Pivotal also recommends that operators expand beyond this guidance and create new, installation-specific monitoring
metrics, thresholds, and alerts based on learning from their own installations.</p>

<h4><a id="bosh-metrics"></a> BOSH Metrics</h4>

<p>All BOSH-deployed components generate the following metrics. Monitor them to ensure that they are not consuming excess resources.</p>

<table>
   <tr><th colspan="3" style="text-align: center;"><br> system.mem.percent<br><br></th></tr>
   <tr>
      <th width="25%">Description</th>
      <td>Percentage used of the VM Memory for MySQL, Redis, ElasticSearch data, and ElasticSearch master.<br><br>
      <strong>Use</strong>: Too much VM Memory usage will likely negatively impact data storage and access performance.
      <br><br>
      <strong>Origin</strong>: JMX Bridge or BOSH HM<br>
      <strong>Type</strong>: percent<br>
      <strong>Frequency</strong>: 30 s (default), 10 s (configurable minimum)<br>
   </tr>
   <tr>
      <th>Recommended measurement</th>
      <td>Average over last 10 minutes</td>
   </tr>
   <tr>
      <th>Recommended alert thresholds</th>
      <td><strong>Yellow warning</strong>: &gt; N/A <br>
      <strong>Red critical</strong>: &gt; 80%</td>
   </tr>
   <tr>
      <th>Recommended response</th>
      <td>Scale up as appropriate.
      </td>
   </tr>
</table>

<table>
   <tr><th colspan="3" style="text-align: center;"><br> persistent.disk.percent<br><br></th></tr>
   <tr>
      <th width="25%">Description</th>
      <td>Percentage used of the VM persistent disk for MySQL, Redis, ElasticSearch data, and ElasticSearch master.<br><br>
      <strong>Use</strong>: It is important to make sure that the system disks of data services do not fill up and cause data loss and performance degradation.
      <br><br>
      <strong>Origin</strong>: JMX Bridge or BOSH HM<br>
      <strong>Type</strong>: percent<br>
      <strong>Frequency</strong>: 30 s (default), 10 s (configurable minimum)<br>
   </tr>
   <tr>
      <th>Recommended measurement</th>
      <td>Average over last 10 minutes</td>
   </tr>
   <tr>
      <th>Recommended alert thresholds</th>
      <td><strong>Yellow warning</strong>: &gt; N/A <br>
      <strong>Red critical</strong>: &gt; 80%</td>
   </tr>
   <tr>
      <th>Recommended response</th>
      <td>Scale up as appropriate.
      </td>
   </tr>
</table>

<h4><a id="system-metrics"></a> System Metrics</h4>

<p>All apps pushed using Cloud Foundry automatically emit the following app system metrics. PCF Metrics is a collection of apps like any other CF apps, and thus can be monitored by PCF Metrics (among other monitoring services). The following KPIs can indicate problems with your installation.</p>

<table>
   <tr><th colspan="3" style="text-align: center;"><br> system.mem.percent<br><br></th></tr>
   <tr>
      <th width="25%">Description</th>
      <td>Percentage used of the app container memory for PCF Metrics apps (metrics-ingestor, mysql-logqueue, elasticsearch-logqueue, metrics, metrics-ui).<br><br>
      <strong>Use</strong>: PCF Metrics apps running out of memory will likely negatively impact performance.
      <br><br>
      <strong>Origin</strong>: Firehose<br>
      <strong>Type</strong>: percent<br>
      <strong>Frequency</strong>: Every minute<br>
   </tr>
   <tr>
      <th>Recommended measurement</th>
      <td>Average over last 10 minutes</td>
   </tr>
   <tr>
      <th>Recommended alert thresholds</th>
      <td><strong>Yellow warning</strong>: &gt; N/A <br>
      <strong>Red critical</strong>: &gt; 80%</td>
   </tr>
   <tr>
      <th>Recommended response</th>
      <td>Scale up as appropriate.
      </td>
   </tr>
</table>

<table>
   <tr><th colspan="3" style="text-align: center;"><br> persistent.disk.percent<br><br></th></tr>
   <tr>
      <th width="25%">Description</th>
      <td>Percentage used of the app container persistent disk for PCF Metrics apps (metrics-ingestor, mysql-logqueue, elasticsearch-logqueue, metrics, metrics-ui).<br><br>
      <strong>Use</strong>: PCF Metrics apps running out of disk will likely negatively impact performance.
      <br><br>
      <strong>Origin</strong>: Firehose<br>
      <strong>Type</strong>: percent<br>
      <strong>Frequency</strong>: Every minute<br>
   </tr>
   <tr>
      <th>Recommended measurement</th>
      <td>Average over last 10 minutes</td>
   </tr>
   <tr>
      <th>Recommended alert thresholds</th>
      <td><strong>Yellow warning</strong>: &gt; N/A <br>
      <strong>Red critical</strong>: &gt; 80%</td>
   </tr>
   <tr>
      <th>Recommended response</th>
      <td>Scale up as appropriate.
      </td>
   </tr>
</table>

<h4><a id="custom-metrics"></a> Custom Metrics</h4>

<p>All PCF Metrics apps are already set up to emit certain custom metrics to indicate app health. As long as you make the appropriate configurations to export these metrics, they can be monitored by PCF Metrics (among other monitoring services). The following KPIs can indicate problems with your installation.
Please refer to the <a href="https://docs.pivotal.io/metrics-forwarder/index.html">Metrics Forwarder documentation</a> for more information about how to set up custom metrics with the Metrics Forwarder.</p>

<table>
   <tr><th colspan="3" style="text-align: center;"><br> metric_processor.envelopes_stored.rate.1_minute<br><br></th></tr>
   <tr>
      <th width="25%">Description</th>
      <td>The rate at which metrics processor stores metric envelopes to its persistent data store for mysql-logsqueue.<br><br>
      <strong>Use</strong>: Zero-value rate indicates that no metrics have been stored, which is likely caused by some major metrics processing errors or failures.
      <br><br>
      <strong>Origin</strong>: Firehose<br>
      <strong>Type</strong>: count per minute<br>
      <strong>Frequency</strong>: Every minute<br>
   </tr>
   <tr>
      <th>Recommended measurement</th>
      <td>At all times for the past 30 minutes</td>
   </tr>
   <tr>
      <th>Recommended alert thresholds</th>
      <td>Below 0 at all times for the past 30 minutes</td>
   </tr>
   <tr>
      <th>Recommended response</th>
      <td>Consult the <a href="http://docs.pivotal.io/pcf-metrics/troubleshooting.html">troubleshooting document</a> for further guidance.</td>
   </tr>
</table>

<table>
   <tr><th colspan="3" style="text-align: center;"><br> log_processor.envelopes_stored.rate.1_minute<br><br></th></tr>
   <tr>
      <th width="25%">Description</th>
      <td>The rate at which log processor stores log envelopes to its persistent data store for PCF Metrics apps (metrics-ingestor, mysql-logqueue, elasticsearch-logqueue, metrics, metrics-ui).<br><br>
      <strong>Use</strong>: Zero-value rate indicates that no logs have been stored, which is likely caused by some major logs processing errors or failures.
      <br><br>
      <strong>Origin</strong>: Firehose<br>
      <strong>Type</strong>: count per minute<br>
      <strong>Frequency</strong>: Every minute<br>
   </tr>
   <tr>
      <th>Recommended measurement</th>
      <td>At all times for the past 30 minutes</td>
   </tr>
   <tr>
      <th>Recommended alert thresholds</th>
      <td>Below 0 at all times for the past 30 minutes</td>
   </tr>
   <tr>
      <th>Recommended response</th>
      <td>Consult the <a href="http://docs.pivotal.io/pcf-metrics/troubleshooting.html">troubleshooting document</a> for further guidance.</td>
   </tr>
</table>

<p>If you have any further questions regarding monitoring PCF Metrics, refer to the <a href="http://docs.pivotal.io/pcf-metrics/troubleshooting.html">PCF Metrics troubleshooting guide.</a></p>

        <div><a id='repo-link' href='http://github.com/pivotal-cf/docs-metrics/tree/1.4/monitoringpcfmetrics.html.md.erb'>View the source for this page in GitHub</a></div>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='https://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='https://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='https://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="http://support.pivotal.io" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
