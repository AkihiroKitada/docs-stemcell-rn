<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Installing PCF Metrics |
    Pivotal Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
<script type="text/javascript">
  if (window.location.host === 'docs.pivotal.io') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39702075-1']);
    _gaq.push(['_setDomainName', 'pivotal.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0055/2990.js?"+Math.floor(new Date().getTime()/3600000);
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>

<!-- Munchkin Marketo Script -->
<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="pcf-metrics pcf-metrics_1-4 pcf-metrics_1-4_installing has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "pivotal.io";
    </script>

      <header class="global-header header header-layout js-bar-links">
    <a class="pivotal-logo" href="/">
    </a>
    <a href="/" class="global-header-title">
      <span class="title-deemph">Pivotal</span> Documentation
    </a>
    <div class="btn-menu" data-behavior="MenuMobile"></div>
    <div class="header-links">
      <div class="header-item">
        <a href="https://network.pivotal.io/">Downloads</a>
      </div>
      <div class="header-item">
        <a href="http://support.pivotal.io" target="_blank">Support</a>
      </div>

      <div class="header-item embedded-searchbar">
          <form method="get" action="/search">
            <input name="q" placeholder="Search PCF Metrics 1.4" class="search-box" />
              <input type="hidden" name="product_name" value="PCF Metrics" />
              <input type="hidden" name="product_version" value="1.4"/>
          </form>
      </div>
      
    </div>
  </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>
      <li>
        <a id='home-nav-link' href="/pcf-metrics/1-4/index.html">Pivotal Cloud Foundry Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/installing.html">Installing PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/sizing.html">Sizing PCF Metrics for Your System</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/using.html">Monitoring and Troubleshooting Apps with PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/monitoringpcfmetrics.html">Monitoring PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/troubleshooting.html">Troubleshooting PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/architecture.html">PCF Metrics Product Architecture</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-4/rn-ki.html">Release Notes and Known Issues</a>
      </li>

    </ul>
  </div>
</div><!--end of sub-nav-->
      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
          <div class="local-header title-container">
    <div class="local-header version-info">
      LATEST VERSION: 1.4 - <a href="">CHANGELOG</a>
    </div>
    <div class="local-header local-title clearfix">
      <img src="/images/cloud_rings.png">
      <span class="local-header-title">PCF Metrics
      </span>
      <span class="local-header local-version header-dropdown">
        <a class="local-header header-dropdown-link">v1.4</a>
        <span class="local-header header-dropdown-content">
          <ul>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-3/installing.html">v1.3</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-2/installing.html">v1.2</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-1/installing.html">v1.1</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-0/installing.html">v1.0</a>
                </li>
          </ul>
        </span>
      </span>

      <!-- search was here -->
    </div>
    <div class="local-header local-header-links">
    </div>
  </div>

          <h1 class="title-container" >
    Installing PCF Metrics
  </h1>

          <div id="js-quick-links" class="list-style-none">
            <div class="quick-links"><ul>
<li><a href="#step1">Add the PCF Metrics Tile to Ops Manager</a></li>
<li>
<a href="#step2">Configure the PCF Metrics Tile</a><ul>
<li><a href="#az">Assign Availability Zones (AZs) and Networks</a></li>
<li><a href="#mc-config">Configure Metrics Components</a></li>
<li><a href="#errands">Configure Errands</a></li>
<li><a href="#resource-config">Configure Resources</a></li>
<li><a href="#stemcell">Import Stemcell</a></li>
</ul>
</li>
<li><a href="#step3">Deploy PCF Metrics</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <p>This document describes how to install and configure Pivotal Cloud Foundry (PCF) Metrics.</p>

<p>To use the custom metrics feature of the PCF Metrics tile, you must have the Metrics Forwarder tile.
However, the PCF Metrics tile can be installed without the Metrics Forwarder tile. </p>

<p>For information about the components deployed as part of this install procedure,
see <a href="/pcf-metrics/1-4/architecture.html">PCF Metrics Product Architecture</a>.</p>

<h2><a id='step1'></a> Add the PCF Metrics Tile to Ops Manager</h2>

<ol>
<li>Download the PCF Metrics file from
<a href="https://network.pivotal.io/products/pcf-metrics">Pivotal Network</a>.</li>
<li>Upload the PCF Metrics file to your Ops Manager installation.</li>
<li>Click  <strong>Add</strong> next to the uploaded product description in the <strong>Available Products</strong>
view to add PCF Metrics to your <strong>Installation Dashboard</strong>.</li>
</ol>

<h2><a id='step2'></a>Configure the PCF Metrics Tile</h2>

<p class="note"><strong>Note</strong>: The following procedures offer a standard configuration.
              To customize PCF Metrics for high capacity,
              see the <a href="sizing.html">Sizing PCF Metrics for Your System</a>.</p>

<ol>
<li><p>From the <strong>Installation Dashboard</strong>, click the <strong>PCF Metrics</strong> tile.</p></li>
<li><p>Follow the procedures below to configure the PCF Metrics tile:</p>

<ul>
<li><a href="#az">Assign Availability Zones (AZs) and Networks</a></li>
<li><a href="#mc-config">Configure Metrics Components</a></li>
<li><a href="#errands">Configure Errands</a></li>
<li><a href="#resource-config">Configure Resources</a></li>
<li><a href="#stemcell">Import Stemcell</a></li>
</ul></li>
</ol>

<h3><a id='az'></a> Assign Availability Zones (AZs) and Networks</h3>

<ol>
<li>Click <strong>Assign AZs and Networks</strong>.</li>
<li>Select an Availability Zone under <strong>Place singleton jobs</strong>.
<br>
Ops Manager runs Metrics jobs with a single instance in this Availability Zone.</li>
<li><p>Select one or more Availability Zones under <strong>Balance other jobs</strong>.
<br>
Ops Manager balances instances of Metrics jobs with more than one instance
across the Availability Zones that you specify. However this setting does not 
balance Elastic Search jobs across multiple AZs as merely balancing ES jobs across multiple AZs 
does not ensure Highly available ES because ES auto-shards and distributes replicas across ES data nodes in real time. 
So instead, we have added a redis instance between the firehose and ES (<a href="https://docs.pivotal.io/pcf-metrics/1-4/architecture.html">https://docs.pivotal.io/pcf-metrics/1-4/architecture.html</a>) 
which buffers logs before they are written to ES. In case of unavailable ES ( during deployment, ES red indices or AZ failure), 
redis will hold logs in buffer and write it back once ES is stable again. You can create multiple redis jobs and balance them across AZs for ensuring HA redis in case of AZ failure. </p></li>
<li><p>Use the drop-down menu to select a network.
<br>
PCF Metrics should be installed on the same network as the Elastic Runtime tile uses.
However, if you do select a different subnet network, then refer to the table below when you configure
the subnet network in the Elastic Runtime tile to make sure that you have
the ports needed for each of the PCF Metrics data services.</p>

<table border="1" class="nice">
  <thead>
    <tr>
      <th>Service</th>
      <th>Port</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Elasticsearch</td>
      <td>9200</td>
    </tr>
    <tr>
      <td>MySQL</td>
      <td>3306</td>
    </tr>
    <tr>
      <td>Redis</td>
      <td>6379</td>
    </tr>
  </tbody>
</table></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>

<h3><a id="mc-config"></a> Configure Metrics Components</h3>

<ol>
<li>Click <strong>Metrics Components Config</strong>.</li>
<li>Review the <strong>MySQL Logqueue Count</strong> value.
You can increase this instance count at any time to accommodate higher levels of inbound metrics traffic. </li>
<li>Review the <strong>Elasticsearch Logqueue Count</strong> value.
You can increase this instance count at any time to accommodate higher levels of inbound log traffic. </li>
<li>Review the <strong>Ingestor Count</strong> value.
You can increase this instance count at any time to accommodate higher levels of Loggregator Firehose traffic. </li>
<li>Review the <strong>Metrics API server instance count</strong> value.
You can increase this instance count at any time to accommodate deployments with more apps, metrics, and logs.</li>
<li>Click <strong>Save</strong>.</li>
</ol>

<h3><a id="errands"></a> Configure Errands</h3>

<p>To properly configure the <strong>Errands</strong> pane, follow the procedure that corresponds to your Ops Manager version. </p>

<ul>
<li><a href="#19">Configure Errands for Ops Manager v1.9</a></li>
<li><a href="#110">Configure Errands for Ops Manager v1.10</a></li>
</ul>

<h4><a name='19'></a> Configure Errands for Ops Manager v1.9</h4>

<ol>
<li>Click <strong>Errands</strong>.
<p class="note"><strong>Note:</strong> The PCF Metrics tile selects all <strong>Post-Deploy Errands</strong> by default.
 Pivotal recommends that you do not deselect any errands as doing so can cause issues with the deployment of the tile.
 However, you can deselect the <b>Remove PCF Metrics 1.3 CF Resources Errand</b> and
 <strong>Migrate Old Data to 1.4 Errand</strong> after deploying v1.4 of the tile.</p></li>
<li><p>Review the <strong>Post-Deploy Errands</strong> and <strong>Pre-Delete Errands</strong>:
If you are deploying the tile for the first time, select all <strong>Post-Deploy Errands</strong>.<br>
 The following list describes what the <strong>Smoke Tests</strong> errand does.
 See <a href="/pcf-metrics/1-4/troubleshooting.html#smoke-test">Smoke Test Errors</a> in <em>Troubleshooting PCF Metrics</em>
 for information on resolving errors discovered by this errand:</p>

<ul>
<li>Confirms that MySQL ingests metrics</li>
<li>Confirms that Elasticsearch ingests logs</li>
<li>Confirms that the Metrics API returns metrics and logs</li>
<li><p>Confirms that any custom metrics coming out of the Firehose are ingested and stored</p>

<p class="note"><strong>Note</strong>: If you deselect <strong>Remove PCF Metrics 1.4 CF Resources Errand</strong>
   under <strong>Pre-Delete Errands</strong>, artifacts might remain after the PCF Metrics tile uninstalls.</p></li>
</ul></li>
</ol>

<h4><a id='110'></a> Configure Errands for Ops Manager v1.10</h4>

<ol>
<li><p>Click <strong>Errands</strong>.</p></li>
<li><p>Review the <strong>Post-Deploy Errands</strong> and <strong>Pre-Delete Errands</strong>:</p>

<ol>
<li>If you are deploying the tile for the first time, set all <strong>Post-Deploy Errands</strong> to <strong>On</strong>.</li>
<li><p>For deployments after the initial install, configure the <strong>Post-Deploy Errands</strong> as follows:</p>

<ol>
<li>Set <strong>Remove PCF Metrics 1.3 CF Resources Errand</strong> to <strong>When Changed</strong></li>
<li>Set <strong>Push PCF Metrics components Errand</strong> to <strong>On</strong></li>
<li>Set <strong>Migrate Old Data to 1.4 Errand</strong> to <strong>When Changed</strong></li>
<li>Set <strong>Smoke Tests Errand</strong> to <strong>On</strong><br>
The following list describes what the <strong>Smoke tests</strong> errand does.
See <a href="/pcf-metrics/1-4/troubleshooting.html#smoke-test">Smoke Test Errors</a> in <em>Troubleshooting PCF Metrics</em> for information on resolving errors discovered by this errand:

<ul>
<li>Confirms that MySQL ingests metrics</li>
<li>Confirms that Elasticsearch ingests logs</li>
<li>Confirms that the Metrics API returns metrics and logs</li>
<li>Confirms that any custom metrics coming out of the Firehose are ingested and stored</li>
</ul></li>
</ol>

<p class="note"><strong>Note</strong>: If you set <strong>Remove PCF Metrics 1.4 CF Resources</strong> 
   under <strong>Pre-Delete Errands</strong> to <strong>Off</strong>,
   artifacts might remain after the PCF Metrics tile uninstalls.</p></li>
</ol></li>
</ol>

<h3><a id="resource-config"></a> Configure Resources</h3>

<ol>
<li>Click <strong>Resource Config</strong>.</li>
<li><p>Review the resource configurations. By default, the settings match the instance types that are best suited for each job.
For reference, the following table shows the default resource and IP requirements for installing the PCF Metrics tile:
<table border="1" class="nice">
<thead>
<tr>
  <th>Resource</th>
  <th>Instances</th>
  <th>Persistent</th>
  <th>CPU</th>
  <th>RAM</th>
  <th>Ephemeral</th>
  <th>Static IP</th>
  <th>Dynamic IP</th>
</tr>
</thead>
<tbody>
<tr>
  <td>Elasticsearch Master</td>
  <td>1</td>
  <td>10&nbsp;GB</td>
  <td>2</td>
  <td>8&nbsp;GB</td>
  <td>16&nbsp;GB</td>
  <td>1</td>
  <td>0</td>
</tr>
<tr>
  <td>Elasticsearch Data</td>
  <td>4</td>
  <td>100&nbsp;GB</td>
  <td>2</td>
  <td>16&nbsp;GB</td>
  <td>32&nbsp;GB</td>
  <td>4</td>
  <td>0</td>
</tr>
<tr>
  <td>Redis</td>
  <td>1 (Not configurable)</td>
  <td>10&nbsp;GB</td>
  <td>4</td>
  <td>4&nbsp;GB</td>
  <td>8&nbsp;GB</td>
  <td>1</td>
  <td>0</td>
</tr>
<tr>
  <td>MySQL Server</td>
  <td>1 (Not configurable)</td>
  <td>500&nbsp;GB</td>
  <td>4</td>
  <td>16&nbsp;GB</td>
  <td>32&nbsp;GB</td>
  <td>1</td>
  <td>0</td>
</tr>
</tbody>
</table> 
If you expect a high level of use, you might need to increase the disk resources available to your instances. 
For more information, see <a href="/pcf-metrics/1-4/sizing.html">Sizing PCF Metrics for Your System</a>.</p>

<p class="note"><strong>Note:</strong> For Ops Manager v1.9, if you configure a job with persistent disk larger than 2&nbsp;TB,
   you might experience disk partitioning issues with the BOSH Director.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>

<h3><a id="stemcell"></a> Import Stemcell</h3>

<ol>
<li>Navigate to <a href="https://network.pivotal.io">Pivotal Network</a> and click <strong>Stemcells</strong>.</li>
<li>Download the appropriate stemcell version for your IaaS.
<p class='note'><strong>Note:</strong> On AWS, make sure to use a HVM stemcell if you are using the default instance sizes.</p></li>
<li>Click <strong>Import Stemcell</strong> and select the stemcell file you downloaded.</li>
</ol>

<h2><a id='step3'></a>Deploy PCF Metrics</h2>

<ol>
<li>Click <strong>Apply Changes</strong> to install the service.
If the smoke tests fail, see <a href="/pcf-metrics/1-4/troubleshooting.html#smoke-test">Smoke Test Errors</a> in <em>Troubleshooting PCF Metrics</em>.</li>
</ol>

<p>For more information on how to log in, use, and interpret data from PCF Metrics, see <a href="/pcf-metrics/1-4/using.html">Monitoring and Troubleshooting Apps with PCF Metrics</a>.</p>

        <div><a id='repo-link' href='http://github.com/pivotal-cf/docs-metrics/tree/1.4/installing.html.md.erb'>View the source for this page in GitHub</a></div>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='https://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='https://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='https://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="http://support.pivotal.io" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
