<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Monitoring and Troubleshooting Apps with PCF Metrics |
    Pivotal Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
<script type="text/javascript">
  if (window.location.host === 'docs.pivotal.io') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39702075-1']);
    _gaq.push(['_setDomainName', 'pivotal.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0055/2990.js?"+Math.floor(new Date().getTime()/3600000);
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>

<!-- Munchkin Marketo Script -->
<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="pcf-metrics pcf-metrics_1-3 pcf-metrics_1-3_using has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "pivotal.io";
    </script>

      <header class="global-header header header-layout js-bar-links">
    <a class="pivotal-logo" href="/">
    </a>
    <a href="/" class="global-header-title">
      <span class="title-deemph">Pivotal</span> Documentation
    </a>
    <div class="btn-menu" data-behavior="MenuMobile"></div>
    <div class="header-links">
      <div class="header-item">
        <a href="https://network.pivotal.io/">Downloads</a>
      </div>
      <div class="header-item">
        <a href="http://support.pivotal.io" target="_blank">Support</a>
      </div>

      <div class="header-item embedded-searchbar">
          <form method="get" action="/search">
            <input name="q" placeholder="Search PCF Metrics 1.3" class="search-box" />
              <input type="hidden" name="product_name" value="PCF Metrics" />
              <input type="hidden" name="product_version" value="1.3"/>
          </form>
      </div>
      
    </div>
  </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>
      <li>
        <a id='home-nav-link' href="/pcf-metrics/1-3/index.html">Pivotal Cloud Foundry Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-3/installing.html">Installing PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-3/sizing.html">Sizing PCF Metrics for Your System</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-3/using.html">Monitoring and Troubleshooting Apps with PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-3/troubleshooting.html">Troubleshooting PCF Metrics</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-3/architecture.html">PCF Metrics Product Architecture</a>
      </li>

      <li>
        <a href="/pcf-metrics/1-3/rn-ki.html">Release Notes and Known Issues</a>
      </li>

    </ul>
  </div>
</div><!--end of sub-nav-->

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
          <div class="local-header title-container">
    <div class="local-header version-info">
      LATEST VERSION: 1.4 - <a href="">CHANGELOG</a>
    </div>
    <div class="local-header local-title clearfix">
      <img src="/images/cloud_rings.png">
      <span class="local-header-title">PCF Metrics
      </span>
      <span class="local-header local-version header-dropdown">
        <a class="local-header header-dropdown-link">v1.3</a>
        <span class="local-header header-dropdown-content">
          <ul>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-4/using.html">v1.4</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-2/using.html">v1.2</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-1/using.html">v1.1</a>
                </li>
                <li>
                    <a href="http://docs.pivotal.io/pcf-metrics/1-0/using.html">v1.0</a>
                </li>
          </ul>
        </span>
      </span>

      <!-- search was here -->
    </div>
    <div class="local-header local-header-links">
    </div>
  </div>

          <h1 class="title-container" >
    Monitoring and Troubleshooting Apps with PCF Metrics
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#get-started">View an App</a></li>
<li><a href="#time">Change the Time Frame</a></li>
<li>
<a href="#metrics">Interpret Metrics</a><ul>
<li><a href="#container">Container Metrics</a></li>
<li><a href="#network">Network Metrics</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#logs">Logs</a></li>
</ul>
</li>
<li>
<a href="#trace">Trace App Requests</a><ul>
<li><a href="#before">Prerequisite</a></li>
<li><a href="#trace-explorer">Use the Trace Explorer</a></li>
</ul>
</li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <p>This topic describes how developers can monitor and troubleshoot their apps using Pivotal Cloud Foundry (PCF) Metrics. </p>

<h2><a id="overview"></a> Overview</h2>

<p>PCF Metrics helps you understand and troubleshoot the health and performance of your apps by displaying the following:</p>

<ul>
<li><a href="#container">Container Metrics</a>: A graph of CPU, memory, and disk usage percentages </li>
<li><a href="#network">Network Metrics</a>: A graph of requests, HTTP errors, and response times </li>
<li><a href="#events">App Events</a>: A graph of update, start, stop, crash, SSH, and staging failure events</li>
<li><a href="#logs">Logs</a>: A list of app logs that you can search, filter, and download</li>
<li><a href="#trace">Trace Explorer</a>: A graph that traces a request as it flows through your apps and their endpoints, along with the corresponding logs</li>
</ul>

<p>For example, if you see that an app crashed on the <strong>Events</strong> graph, you can zoom in and view the corresponding container metrics, network metrics, and logs. </p>

<h2><a id='get-started'></a> View an App</h2>

<p>In a browser, navigate to <code>metrics.YOUR-SYSTEM-DOMAIN</code> and log in with your User Account and Authentication (UAA) credentials. Choose an app for which you want to view metrics or logs. You can view any app that runs in a space that you have access to. </p>

<p><img alt="Search for an app" src="images/search.png" /></p>

<p>PCF Metrics displays app data for a given time frame. See the sections below to <a href="#time">Change the Time Frame</a> for the dashboard, <a href="#metrics">Interpret Metrics</a> information on each graph, and <a href="#trace">Trace App Requests</a> with the Trace Explorer.</p>

<p><img alt="Metrics UI" src="images/full.png" /></p>

<h2><a id="time"></a>Change the Time Frame</h2>

<p>The graphs show time along the horizontal axis. You can change the time frame for all graphs and the logs by using the time selector at the top of the window. Adjust either end of the selector, or click and drag.</p>

<p><img alt="time" src="images/metrics-time.png" /></p>

<p><strong>Zoom</strong>: From within any graph, click and drag to zoom in on areas of interest. This adjusts all of the graphs, and the logs, to show data from that time frame.</p>

<p><img src="images/metric-zoom.png" /></p>

<p><strong>Drag</strong>: From underneath the x-axis of any graph, drag left or right to view data for an earlier or later time. </p>

<h2><a id='metrics'></a> Interpret Metrics</h2>

<p>See the following sections to understand how to use each of the views in the dashboard to monitor and troubleshoot your app.</p>

<h3><a id='container'></a> Container Metrics</h3>

<p>The <strong>Container Metrics</strong> graph displays <strong>CPU</strong>, <strong>Memory</strong>, and <strong>Disk</strong> usage:</p>

<p><img alt="Container View" src="images/container.png" /></p>

<ul>
<li>A spike in CPU might point to a process that is computationally heavy. Scaling app instances can relieve the immediate pressure, but investigate the app to better understand and fix the root cause. </li>
<li>A spike in memory might mean a resource leak in the code. Scaling app memory can also relieve the immediate pressure, but look for and resolve the underlying issue so that it does not occur again. </li>
<li>A spike in disk might mean the app is writing logs to files instead of STDOUT, caching data to local disk, or serializing huge sessions to disk. </li>
</ul>

<h3><a id='network'></a> Network Metrics</h3>

<p>The <strong>Network Metric</strong> graph displays HTTP <strong>Requests and Errors</strong> and <strong>Response Time</strong>:</p>

<p><img alt="Network View" src="images/network.png" /></p>

<ul>
<li>A spike in response time means your users are waiting longer to use your app. Scaling app instances can spread that workload over more resources and result in faster response times. </li>
<li>A spike in HTTP errors means one or more 5xx errors have occurred. Check your app logs for more information. </li>
<li>A spike in HTTP requests means more users are using your app. Scaling app instances can reduce the higher response time that may result.</li>
</ul>

<h3><a id='events'></a> Events</h3>

<p>The <strong>Events</strong> graph shows the following app events:  staging failures (<strong>STG Fail</strong>), <strong>Crash</strong>, <strong>Update</strong>, <strong>Stop</strong>, <strong>Start</strong>, and <strong>SSH</strong>. You can change which events you see using the checkboxes in the upper right. </p>

<p><img alt="Events" src="images/events.png" /></p>

<p class="note"><strong>Note</strong>: The <b>SSH</b> event corresponds to someone successfully using SSH to access a container that runs an instance of the app.</p>

<p>See the following topics for more information about app events:</p>

<ul>
<li><a href="https://docs.run.pivotal.io/devguide/deploy-apps/app-startup.html">About Starting Applications</a></li>
<li><a href="https://docs.run.pivotal.io/devguide/deploy-apps/troubleshoot-app-health.html">Troubleshooting Application Deployment and Health</a><br></li>
</ul>

<h3><a id="logs"></a>Logs</h3>

<p>The <strong>Logs</strong> view displays app log data ingested from the <a href="https://docs.pivotal.io/pivotalcf/loggregator/architecture.html#firehose">Loggregator Firehose</a>, including a histogram that displays log frequency for the current time frame: </p>

<p><img alt="Logs" src="images/logs.png" /></p>

<p>The list of logs begins at the time indicated by the placement of the log line in the <strong>Events</strong>, <strong>Container</strong>, and <strong>Network</strong> graphs. To adjust the placement of the log line, hover over the graph and click a new location: </p>

<p><img alt="Needle" src="images/needle.png" /></p>

<p>You can interact with the <strong>Logs</strong> view in the following ways:</p>

<ul>
<li><strong>Keyword</strong>: Perform a keyword search. The histogram updates with blue bars based on what you enter. Hover over a histogram bar to view the amount of logs for a specific time based on your filter. </li>
<li><strong>Highlight</strong>: Enter a term to highlight within your search. The histogram updates with yellow bars based on the results. Hover over a histogram bar to view the amount of logs for a specific time that contain the highlighted term. </li>
<li><strong>Sources</strong>: Choose which sources to display logs from. For more information, see <a href="https://docs.pivotal.io/pivotalcf/devguide/deploy-apps/streaming-logs.html#format">Log Types and Their Messages</a>.</li>
<li><strong>Order</strong>: Modify the order in which logs appear. </li>
<li><strong>Download</strong>: Download a file containing logs for the current search. </li>
<li><strong>Copy</strong>: Click the copy icon to copy the text of the log.</li>
<li><strong>View in Trace Explorer</strong>: Open a window to see the trace of the request associated with the log. See <a href="#trace">Trace App Requests</a>.</li>
</ul>

<h2><a id="trace"></a>Trace App Requests</h2>

<p>A request to one of your apps initiates a workflow within the app or system of apps. The record of this workflow is a <em>trace</em>, which you can use to troubleshoot app failures and latency issues. In the Trace Explorer view, PCF Metrics displays an interactive graph of a trace and its corresponding logs. See the sections below to understand how to use the Trace Explorer.</p>

<p>For more information about traces, see the <a href="http://opentracing.io/documentation/#what-is-a-trace">What is a Trace?</a> section of the <em>Open Tracing</em> documentation. </p>

<h3><a id="before"></a> Prerequisite</h3>

<p>PCF Metrics constructs the Trace Explorer view using trace IDs shared across app logs. Before you <a href="#trace-explorer">use the Trace Explorer</a>, examine the following list to ensure PCF metrics can extract the necessary data from your app logs for your specific app type. </p>

<ul>
<li><strong>Spring</strong>: Follow the steps below.

<ol>
<li>Ensure you are using Spring Boot v1.4.3 or later. </li>
<li>Ensure you are using Spring Cloud Sleuth v1.0.12 or later. </li>
<li>Add the following to your app dependency file:
<pre>dependencies { (2)
compile &quot;org.springframework.cloud:spring-cloud-starter-sleuth&quot;
}</pre></li>
</ol></li>
<li><strong>Node.js</strong>, <strong>Go</strong>, <strong>Python</strong>: Ensure that the servers associated with your app do not modify HTTP requests in a way that removes the <code>X-B3-TraceId</code>, <code>X-B3-SpanId</code>, and <code>X-B3-ParentSpan</code> headers from a request. You do not have to add any dependency to your app.</li>
<li><strong>Ruby</strong>: Ruby servers that use a library depending on Rack modify HTTP request headers in way that is incompatible with PCF Metrics. If you want to trace app requests for your Ruby apps, ensure that your framework does not rely on Rack. You may need to write a raw Ruby server that preserves the <code>X-B3-TraceId</code>, <code>X-B3-SpanId</code>, and <code>X-B3-ParentSpan</code> headers in the request.</li>
</ul>

<h3><a id="trace-explorer"></a> Use the Trace Explorer</h3>

<p>This section explains how to view the trace for a request received by your app and interact with the Trace Explorer.</p>

<ol>
<li><p>Select an app in the PCF Metrics dashboard.</p></li>
<li><p>Click the Trace Explorer icon in a log for which you want to trace the request.</p>

<p><img alt="Hover over trace icon" src="images/click-trace.png" /></p>

<ul>
<li>The Trace Explorer displays the apps and endpoints involved in a completing a request, along with the corresponding logs:
<img alt="Trace Explorer" src="images/trace-explorer.png" />
A request corresponds to a single trace ID, displayed in the top left. Each row includes an app in the left column and a <em>span</em> in the right column. A span is a particular endpoint within the app and the time it took to execute, in milliseconds. By default, the graph lists each app and endpoint in the order they were called. 
<p class="note"><strong>Note</strong>: If you do not have access to the space for an app involved in the request, you cannot see the spans or logs from that app.</p></li>
<li>You can click a span to show only logs from that span, or any number of spans to toggle which logs appear. Clicking a span also creates a box with that particular span ID in the <strong>Logs</strong> view: 
<img alt="Click Span" src="images/click-span.png" /><br></li>
<li>If you click <code>APP APP-NAME</code> within a log, PCF Metrics returns you to the dashboard view for that app, with the time frame focused on the time of the log that you clicked from. </li>
</ul></li>
</ol>

        <div><a id='repo-link' href='http://github.com/pivotal-cf/docs-metrics/tree/1.3/using.html.md.erb'>View the source for this page in GitHub</a></div>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='https://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='https://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='https://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="http://support.pivotal.io" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
